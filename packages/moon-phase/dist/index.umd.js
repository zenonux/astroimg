(function(s,o){typeof exports=="object"&&typeof module<"u"?o(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],o):(s=typeof globalThis<"u"?globalThis:s||self,o(s.MoonPhase={},s.Vue))})(this,function(s,o){"use strict";const U=.552284749831,m=o.defineComponent({__name:"MoonPhaseCanvas",props:{size:{default:200},illumination:{},textureUrl:{},moonOrient:{},isUpMoon:{type:Boolean}},setup(e){const n=e,g=window.devicePixelRatio||1,d=o.ref(null),c=o.ref(null),l=o.ref(Array.from({length:8}).fill(0)),r=o.ref(Array.from({length:16}).fill(0)),i=o.ref(Array.from({length:8}).fill(0)),a=o.ref(Array.from({length:16}).fill(0)),M=o.ref({x:n.size/2,y:n.size/2}),b=o.ref(n.size/2),w=o.ref(null);function G(t){if(c.value){c.value.save();try{t()}finally{c.value.restore()}}}function S(){const t=b.value;l.value=[0,t,t,0,0,-t,-t,0];const u=t*U;r.value=[l.value[0]+u,l.value[1],l.value[2],l.value[3]+u,l.value[2],l.value[3]-u,l.value[4]+u,l.value[5],l.value[4]-u,l.value[5],l.value[6],l.value[7]-u,l.value[6],l.value[7]+u,l.value[0]-u,l.value[1]]}function N(t){i.value[0]=l.value[0],i.value[1]=l.value[1],i.value[2]=l.value[6]+(l.value[2]-l.value[6])*t,i.value[3]=l.value[3],i.value[4]=l.value[4],i.value[5]=l.value[5],i.value[6]=l.value[6],i.value[7]=l.value[7],a.value[0]=r.value[14]+(r.value[0]-r.value[14])*t,a.value[1]=r.value[1],a.value[2]=r.value[12]+(r.value[2]-r.value[12])*t,a.value[3]=r.value[3],a.value[4]=r.value[10]+(r.value[4]-r.value[10])*t,a.value[5]=r.value[5],a.value[6]=r.value[8]+(r.value[6]-r.value[8])*t,a.value[7]=r.value[7];for(let u=8;u<16;u++)a.value[u]=r.value[u]}function Q(t,u,f){if(!c.value)return;const v=c.value;G(()=>{S(),N(t),v.translate(M.value.x,M.value.y);const h=u+(f?180:0);v.rotate(h*Math.PI/180),v.filter=`blur(${n.size/100*g}px)`;const C=new Path2D;C.moveTo(i.value[0],i.value[1]),C.bezierCurveTo(a.value[0],a.value[1],a.value[2],a.value[3],i.value[2],i.value[3]),C.bezierCurveTo(a.value[4],a.value[5],a.value[6],a.value[7],i.value[4],i.value[5]),C.bezierCurveTo(a.value[8],a.value[9],a.value[10],a.value[11],i.value[6],i.value[7]),C.bezierCurveTo(a.value[12],a.value[13],a.value[14],a.value[15],i.value[0],i.value[1]);const x=v.createLinearGradient(-b.value,0,b.value,0);x.addColorStop(0,"rgba(0,0,0,.9)"),x.addColorStop(1,"rgba(0,0,0,0.3)"),v.fillStyle=x,v.fill(C)})}function z(t,u,f){if(!c.value)return;const v=c.value,h=n.size;v.clearRect(0,0,h,h),w.value&&v.drawImage(w.value,0,0,h,h),Q(t,u,f)}function y(t){return new Promise((u,f)=>{const v=new Image;v.crossOrigin="anonymous",v.onload=()=>u(v),v.onerror=f,v.src=t})}return o.onMounted(async()=>{var f;if(!d.value)return;c.value=d.value.getContext("2d");const t=d.value;t.width=n.size*g,t.height=n.size*g,t.style.width=n.size+"px",t.style.height=n.size+"px",(f=c.value)==null||f.scale(g,g),w.value=await y(n.textureUrl);const u=1-n.illumination;z(u,n.moonOrient,n.isUpMoon)}),o.watch(()=>[n.illumination,n.moonOrient,n.isUpMoon],([t,u,f])=>{const v=1-t;z(v,u,f)}),(t,u)=>(o.openBlock(),o.createElementBlock("canvas",{ref_key:"canvasRef",ref:d},null,512))}});function T(e=new Date){let n=e.getUTCFullYear(),g=e.getUTCMonth()+1;const d=e.getUTCDate(),c=e.getUTCHours(),l=e.getUTCMinutes(),r=e.getUTCSeconds()+e.getUTCMilliseconds()/1e3,i=(c+l/60+r/3600)/24;g<=2&&(n-=1,g+=12);const a=Math.floor(n/100),M=2-a+Math.floor(a/4);return Math.floor(365.25*(n+4716))+Math.floor(30.6001*(g+1))+d+i+M-1524.5}function W(){const e=(T()-245155009765e-5)/29.530588853;return(e-Math.floor(e))*29.530588853+.28}function F(e){return e>15}var p=(e=>(e.NewMoon="NewMoon",e.WaxingCrescent="WaxingCrescent",e.FirstQuarter="FirstQuarter",e.WaxingGibbous="WaxingGibbous",e.FullMoon="FullMoon",e.WaningGibbous="WaningGibbous",e.LastQuarter="LastQuarter",e.WaningCrescent="WaningCrescent",e))(p||{});function _(e){if(e<1||e>29)return"NewMoon";if(e>1&&e<7)return"WaxingCrescent";if(e>=7&&e<=8)return"FirstQuarter";if(e>8&&e<14)return"WaxingGibbous";if(e>=14&&e<=16)return"FullMoon";if(e>16&&e<21)return"WaningGibbous";if(e>=21&&e<23)return"LastQuarter";if(e>=23&&e<=29)return"WaningCrescent"}s.MoonPhaseCanvas=m,s.MoonPhaseType=p,s.getMoonDay=W,s.getMoonPhaseType=_,s.isUpMoon=F,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})});
