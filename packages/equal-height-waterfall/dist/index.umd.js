(function(n,i){typeof exports=="object"&&typeof module<"u"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(n=typeof globalThis<"u"?globalThis:n||self,i(n.EqualHeightWaterfall={}))})(this,function(n){"use strict";var _=Object.defineProperty;var c=(n,i,a)=>i in n?_(n,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[i]=a;var h=(n,i,a)=>(c(n,typeof i!="symbol"?i+"":i,a),a);class i{constructor(t){h(this,"_items",[]);h(this,"_breakLineAspectRatioSum");h(this,"_containerWidth");h(this,"_itemFallbackAspectRatio");h(this,"_itemMaxWidthPercent");h(this,"_itemMinWidthPercent");h(this,"_itemMaxHeight");h(this,"_gutter");h(this,"_lastLine",[]);h(this,"_lastLineTop",0);this._breakLineAspectRatioSum=t.breakLineAspectRatioSum||2,this._containerWidth=t.containerWidth,this._gutter=t.gutter||4,this._itemFallbackAspectRatio=t.itemFallbackAspectRatio||1,this._itemMaxWidthPercent=t.itemMaxWidthPercent||2/3,this._itemMinWidthPercent=t.itemMinWidthPercent||1/4,this._itemMaxHeight=t.itemMaxHeight||300}_getItemAspectRatio(t){return t.height?t.width/t.height:this._itemFallbackAspectRatio}_getRenderItemAspectRatio(t){return t.renderWidth/t.renderHeight}_resizeItem(t,e){if(!e.length){const s=this._getRenderWidthContainGutter(t);let r=s/this._getItemAspectRatio(t)-this._gutter;r>this._itemMaxHeight&&(r=this._itemMaxHeight);const o=!this._lastLineTop;return this._lastLineTop=o?r:this._lastLineTop+r+this._gutter,{...t,renderLeft:0,renderTop:this._lastLineTop-r,renderWidth:s,renderHeight:r}}else{let s=this._getRenderWidthContainGutter(t);const r=this._getLineUsedWidth(e),o=this._containerWidth-r;return o<s&&(s=o),o-s<this._itemMinWidthPercent*this._containerWidth&&(s=o),{...t,renderHeight:e[0].renderHeight,renderWidth:s-this._gutter,renderLeft:r+this._gutter,renderTop:e[0].renderTop}}}_getRenderWidthContainGutter(t){const e=this._getItemAspectRatio(t)/this._breakLineAspectRatioSum,d=e<this._itemMinWidthPercent?this._itemMinWidthPercent:e>this._itemMaxWidthPercent?this._itemMaxWidthPercent:e;return this._containerWidth*d}_getLineUsedWidth(t){const e=t[t.length-1];return e?e.renderLeft+e.renderWidth:0}_getRandomBetween(t,e){const d=Math.random(),s=t+d*(e-t+1);return Math.floor(s)}add(t){for(let e=0;e<t.length;e++){const d=t[e];this._lastLine.length&&this._getLineUsedWidth(this._lastLine)>=this._containerWidth&&(this._lastLine=[]);const r=this._resizeItem(d,this._lastLine);this._lastLine.push(r),this._items.push(r)}return{items:this._items,renderTotalHeight:this._items[this._items.length-1].renderTop+this._items[this._items.length-1].renderHeight}}clear(){this._items=[],this._lastLine=[],this._lastLineTop=0}}n.EqualHeightWaterfall=i,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
